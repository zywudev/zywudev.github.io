<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.1.1" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.1.1" type="image/png" sizes="32x32"><meta name="description" content="Kotlin Koans 是 Kotlin 官方推出的一系列 Kotlin 语法练习。 一共分为 6 个模块，每个模块若干任务，每个任务都有一系列单元测试，目标就是编码通过单元测试。 本文是在学习 Kotlin Koans 过程中将相关语法点做一个简单的记录。                      Introduction                           Hello_Wo">
<meta property="og:type" content="article">
<meta property="og:title" content="Kotlin Koans 学习笔记">
<meta property="og:url" content="http://wuzhangyang.com/2019/06/28/kotlin-koans-notes/index.html">
<meta property="og:site_name" content="贾小昆">
<meta property="og:description" content="Kotlin Koans 是 Kotlin 官方推出的一系列 Kotlin 语法练习。 一共分为 6 个模块，每个模块若干任务，每个任务都有一系列单元测试，目标就是编码通过单元测试。 本文是在学习 Kotlin Koans 过程中将相关语法点做一个简单的记录。                      Introduction                           Hello_Wo">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-06-28T09:07:12.000Z">
<meta property="article:modified_time" content="2020-09-04T05:58:03.282Z">
<meta property="article:author" content="贾小昆">
<meta property="article:tag" content="Kotlin">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary"><title>Kotlin Koans 学习笔记 | 贾小昆</title><link ref="canonical" href="http://wuzhangyang.com/2019/06/28/kotlin-koans-notes/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.1.1"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><script src="https://www.googletagmanager.com/gtag/js?id=UA-127464210-1" async=""></script><script>if (window.location.hostname !== 'localhost') {
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'UA-127464210-1');
}</script><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: undefined,
  header: undefined,
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"carbon","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.1.1"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner header-inner--height header-inner--bgcolor"><nav class="header-nav header-nav--sticky"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">搜索</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Kotlin Koans 学习笔记</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2019-06-28</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2020-09-04</span></span><span class="post-meta-item post-meta-item--wordcount"><span class="post-meta-item__icon"><i class="far fa-file-word"></i></span><span class="post-meta-item__info">字数统计</span><span class="post-meta-item__value">4.8k</span></span><span class="post-meta-item post-meta-item--readtime"><span class="post-meta-item__icon"><i class="far fa-clock"></i></span><span class="post-meta-item__info">阅读时长</span><span class="post-meta-item__value">42分</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">阅读次数</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="container"><script src="https://my.openwrite.cn/js/readmore.js"></script><script>const btw = new BTWPlugin();
btw.init({
    id: 'container',
    blogId: '17295-1587352417052-803',
    name: '贾小昆',
    qrcode: 'https://ae01.alicdn.com/kf/H8211b56c06cc47b6846d7e607e7b23432.jpg',
    keyword: 'vip',
});</script><div class="post-body"><blockquote>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://github.com/Kotlin/kotlin-koans">Kotlin Koans</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 是 Kotlin 官方推出的一系列 Kotlin 语法练习。</p>
<p>一共分为 6 个模块，每个模块若干任务，每个任务都有一系列单元测试，目标就是编码通过单元测试。</p>
<p>本文是在学习 Kotlin Koans 过程中将相关语法点做一个简单的记录。</p>
</blockquote>

        <h1 id="Introduction">
          <a href="#Introduction" class="heading-link"><i class="fas fa-link"></i></a>Introduction</h1>
      
        <h2 id="Hello-World">
          <a href="#Hello-World" class="heading-link"><i class="fas fa-link"></i></a>Hello_World</h2>
      <p>和大多数语言一样，第一个任务的名称就是 Hello World。这个任务很简单，就是要求 task0 函数返回一个字符串<code>ok</code>。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task0</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>Kotlin 中函数使用关键字<code>fun</code>声明，返回类型在函数名称的后面，中间以<code>:</code>分开。</p>

        <h2 id="Java-to-Kotlin-Convert">
          <a href="#Java-to-Kotlin-Convert" class="heading-link"><i class="fas fa-link"></i></a>Java to Kotlin Convert</h2>
      <p>将 Java 代码转化为 Kotlin 代码。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// java</span></span><br><span class="line"><span class="keyword">public</span> String task1(Collection&lt;Integer&gt; collection) &#123;</span><br><span class="line">    StringBuilder sb = new StringBuilder();</span><br><span class="line">    sb.append(<span class="string">&quot;&#123;&quot;</span>);</span><br><span class="line">    Iterator&lt;Integer&gt; iterator = collection.iterator();</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">        Integer element = iterator.next();</span><br><span class="line">        sb.append(element);</span><br><span class="line">        <span class="keyword">if</span> (iterator.hasNext()) &#123;</span><br><span class="line">            sb.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sb.append(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//kotlin</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task1</span><span class="params">(collection: <span class="type">Collection</span>&lt;<span class="type">Int</span>&gt;)</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">val</span> sb = StringBuilder()</span><br><span class="line">    sb.append(<span class="string">&quot;&#123;&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> iterator = collection.iterator()</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">        <span class="keyword">val</span> element = iterator.next()</span><br><span class="line">        sb.append(element)</span><br><span class="line">        <span class="keyword">if</span> (iterator.hasNext()) &#123;</span><br><span class="line">            sb.append(<span class="string">&quot;, &quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sb.append(<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> sb.toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Named-Arguments">
          <a href="#Named-Arguments" class="heading-link"><i class="fas fa-link"></i></a>Named Arguments</h2>
      <p>使用 kotlin 提供的 <code>joinToString()</code> 完成任务1，只指定 <code>joinToString()</code> 的参数。</p>
<p>kotlin 中函数参数可以有默认值，当省略相应的参数时使用默认值。与其他语言相比，这可以减少重载数量：</p>
<p>默认值通过类型后面的<code>=</code>及给出的值定义。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">read</span><span class="params">(b: <span class="type">Array</span>&lt;<span class="type">Byte</span>&gt;, off: <span class="type">Int</span> = <span class="number">0</span>, len: <span class="type">Int</span> = b.size)</span></span> &#123; …… &#125;</span><br></pre></td></tr></table></div></figure>

<p>重写一个有默认参数的函数时，我们不允许重新指定默认参数的值。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">foo</span><span class="params">(i: <span class="type">Int</span> = <span class="number">10</span>)</span></span> &#123; …… &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> : <span class="type">A</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">foo</span><span class="params">(i: <span class="type">Int</span>)</span></span> &#123; …… &#125;  <span class="comment">// 不能有默认值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>可以在调用函数时使用命名的函数参数。当一个函数有大量的参数或默认参数时这会非常方便。</p>
<p>回到任务本身，先看一下函数 <code>joinToString</code>：</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Iterable<span class="type">&lt;T&gt;</span>.<span class="title">joinToString</span><span class="params">(separator: <span class="type">CharSequence</span> = <span class="string">&quot;, &quot;</span>, prefix: <span class="type">CharSequence</span> = <span class="string">&quot;&quot;</span>, postfix: <span class="type">CharSequence</span> = <span class="string">&quot;&quot;</span>, limit: <span class="type">Int</span> = <span class="number">-1</span>, truncated: <span class="type">CharSequence</span> = <span class="string">&quot;...&quot;</span>, transform: ((<span class="type">T</span>) -&gt; <span class="type">CharSequence</span>)? = <span class="literal">null</span>)</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">return</span> joinTo(StringBuilder(), separator, prefix, postfix, limit, truncated, transform).toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>该函数对分隔符，前缀，后缀等其他参数都指定了默认值，我们只需要重新指定前缀、后缀两个参数。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task2</span><span class="params">(collection: <span class="type">Collection</span>&lt;<span class="type">Int</span>&gt;)</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">return</span> collection.joinToString(postfix = <span class="string">&quot;&#125;&quot;</span>,prefix = <span class="string">&quot;&#123;&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Default-Arguments">
          <a href="#Default-Arguments" class="heading-link"><i class="fas fa-link"></i></a>Default Arguments</h2>
      <p>使用参数默认值，修改<code>foo</code>函数，实现 Java 中需要重载才能实现的功能。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">foo</span><span class="params">(name: <span class="type">String</span>, number: <span class="type">Number</span> = <span class="number">42</span>, toUpperCase: <span class="type">Boolean</span> = <span class="literal">false</span>)</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">if</span> (toUpperCase) name.toUpperCase() <span class="keyword">else</span> name) + number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task3</span><span class="params">()</span></span>: String &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (foo(<span class="string">&quot;a&quot;</span>) +</span><br><span class="line">            foo(<span class="string">&quot;b&quot;</span>, number = <span class="number">1</span>) +</span><br><span class="line">            foo(<span class="string">&quot;c&quot;</span>, toUpperCase = <span class="literal">true</span>) +</span><br><span class="line">            foo(name = <span class="string">&quot;d&quot;</span>, number = <span class="number">2</span>, toUpperCase = <span class="literal">true</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>非常简洁。这里还可以看出 <code>if</code> 是一个表达式，即它会返回一个值。 因此就不需要三元运算符（条件 ? 然后 : 否则）</p>

        <h2 id="Lambdas">
          <a href="#Lambdas" class="heading-link"><i class="fas fa-link"></i></a>Lambdas</h2>
      <p>使用 Lambda 重写 Java 代码：</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// java</span></span><br><span class="line"><span class="keyword">public</span> boolean task4(Collection&lt;Integer&gt; collection) &#123;</span><br><span class="line">     <span class="keyword">return</span> Iterables.any(collection, new Predicate&lt;Integer&gt;() &#123;</span><br><span class="line">         <span class="meta">@Override</span></span><br><span class="line">         <span class="keyword">public</span> boolean apply(Integer element) &#123;</span><br><span class="line">             <span class="keyword">return</span> element % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// kotlin</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task4</span><span class="params">(collection: <span class="type">Collection</span>&lt;<span class="type">Int</span>&gt;)</span></span>: <span class="built_in">Boolean</span> = collection.any &#123; x -&gt; x % <span class="number">2</span> == <span class="number">0</span> &#125;</span><br></pre></td></tr></table></div></figure>

<p>Lambda 表达式的特征：</p>
<ul>
<li>Lambdas 表达式是花括号括起来的代码块。</li>
<li>如果一个 lambda 表达式有参数，前面是参数，后跟<code>-&gt;</code> 。</li>
<li>函数体写在<code>-&gt;</code>符号后面。</li>
</ul>

        <h2 id="String-Templates">
          <a href="#String-Templates" class="heading-link"><i class="fas fa-link"></i></a>String Templates</h2>
      <p>生成一个正则表达式，可以匹配<code>13 JUN 1992</code> 这样格式的字符串。</p>
<p>kotlin 中支持两种字符串格式：</p>
<p>一种是一对<code>&quot;</code>包起来的字符串，支持转义字符。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> s = <span class="string">&quot;Hello, world!\n&quot;</span></span><br></pre></td></tr></table></div></figure>

<p>一种是一对<code> &quot;&quot;&quot;</code>包起来的字符串，不需要用<code>\</code>来转义，可以直接使用各种符号，包括换行符。</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val text &#x3D; &quot;&quot;&quot;</span><br><span class="line">    for (c in &quot;foo&quot;)</span><br><span class="line">        print(c)</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></div></figure>

<p>字符串字面值可以包含<em>模板表达式</em> ，即一些小段代码，会求值并把结果合并到字符串中。 模板表达式以美元符（<code>$</code>）开头，由一个简单的名字构成:</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> i = <span class="number">10</span></span><br><span class="line">println(<span class="string">&quot;i = <span class="variable">$i</span>&quot;</span>) <span class="comment">// 输出“i = 10”</span></span><br></pre></td></tr></table></div></figure>

<p>回到任务，修改模板字符串，使其可以匹配测试中的日期格式。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> month = <span class="string">&quot;(JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task5</span><span class="params">()</span></span>: String = <span class="string">&quot;&quot;&quot;\d&#123;2&#125;\ <span class="variable">$month</span>\ \d&#123;4&#125;&quot;&quot;&quot;</span></span><br></pre></td></tr></table></div></figure>


        <h2 id="Data-Classes">
          <a href="#Data-Classes" class="heading-link"><i class="fas fa-link"></i></a>Data Classes</h2>
      <p>将 Java 中的数据实体类转化成 Kotlin。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// java</span></span><br><span class="line"><span class="keyword">public</span> static <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> int age;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> Person(String name, int age) &#123;</span><br><span class="line">         <span class="keyword">this</span>.name = name;</span><br><span class="line">         <span class="keyword">this</span>.age = age;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> String getName() &#123;</span><br><span class="line">         <span class="keyword">return</span> name;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> int getAge() &#123;</span><br><span class="line">         <span class="keyword">return</span> age;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// kotlin</span></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br></pre></td></tr></table></div></figure>

<p>kotlin 中使用<code>data</code>标记的类，编译器会自动根据主构造函数中定义的属性生成下面这些成员函数：</p>
<ul>
<li><code>equals()</code>/<code>hashCode()</code> 对；</li>
<li><code>toString()</code> 格式是 <code>&quot;Person(name=John, age=42)&quot;</code>；</li>
<li><code>componentN()</code>按声明顺序对应于所有属性；</li>
<li><code>copy()</code> 函数。</li>
</ul>

        <h2 id="Nullable-Type">
          <a href="#Nullable-Type" class="heading-link"><i class="fas fa-link"></i></a>Nullable Type</h2>
      <p>将 Java 版本的 <code>sendMessageToClient</code> 方法使用 kotlin 改写，只能使用 <code>if</code> 表达式。</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessageToClient</span><span class="params">(<span class="meta">@Nullable</span> Client client, <span class="meta">@Nullable</span> String message, <span class="meta">@NotNull</span> Mailer mailer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (client == <span class="keyword">null</span> || message == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    PersonalInfo personalInfo = client.getPersonalInfo();</span><br><span class="line">    <span class="keyword">if</span> (personalInfo == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    String email = personalInfo.getEmail();</span><br><span class="line">    <span class="keyword">if</span> (email == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    mailer.sendMessage(email, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>kotlin 中，如果一个变量可能为空，在定义的时候需要在类型后面加上 <code>?</code> </p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> a: <span class="built_in">Int</span>? = <span class="literal">null</span></span><br></pre></td></tr></table></div></figure>

<p>对于可能为空的变量，如果必须在其值不为 null 时才进行后续操作，可以使用 <code>?.</code>操作符进行保护。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a?.toLong()</span><br></pre></td></tr></table></div></figure>

<p>如果变量为空，想要提供一个替代值，可以使用 <code>?:</code>：</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> b = a?.toLong() ?: <span class="number">0L</span></span><br></pre></td></tr></table></div></figure>

<p>回到任务本身。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sendMessageToClient</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        client: <span class="type">Client</span>?, message: <span class="type">String</span>?, mailer: <span class="type">Mailer</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> email = client?.personalInfo?.email</span><br><span class="line">    <span class="keyword">if</span> (email != <span class="literal">null</span> &amp;&amp; message != <span class="literal">null</span>) &#123;</span><br><span class="line">        mailer.sendMessage(email,message)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Smart-Casts">
          <a href="#Smart-Casts" class="heading-link"><i class="fas fa-link"></i></a>Smart Casts</h2>
      <p>使用 kotlin 中 的Smart Cast 和 when表达式重新实现 Java 代码中的 <code>eval()</code> 函数。</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">eval</span><span class="params">(Expr expr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (expr <span class="keyword">instanceof</span> Num) &#123;</span><br><span class="line">        <span class="keyword">return</span> ((Num) expr).getValue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (expr <span class="keyword">instanceof</span> Sum) &#123;</span><br><span class="line">        Sum sum = (Sum) expr;</span><br><span class="line">        <span class="keyword">return</span> eval(sum.getLeft()) + eval(sum.getRight());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Unknown expression&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>kotlin 中使用<code>when</code>代替了<code>switch</code>，功能更强大。</p>
<p>在 <code>when</code> 中，我们使用 <code>-&gt;</code> 表示执行某一分支后的操作，<code>-&gt;</code> 之前是条件，可以是任何表达式。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">when</span> (x) &#123;</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span> -&gt; print(<span class="string">&quot;x == 0 or x == 1&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span> -&gt; print(<span class="string">&quot;otherwise&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">when</span> (x) &#123;</span><br><span class="line">    <span class="keyword">in</span> <span class="number">1</span>..<span class="number">10</span> -&gt; print(<span class="string">&quot;x is in the range&quot;</span>)</span><br><span class="line">    <span class="keyword">in</span> validNumbers -&gt; print(<span class="string">&quot;x is valid&quot;</span>)</span><br><span class="line">    !<span class="keyword">in</span> <span class="number">10</span>..<span class="number">20</span> -&gt; print(<span class="string">&quot;x is outside the range&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span> -&gt; print(<span class="string">&quot;none of the above&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>回到任务本身。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">eval</span><span class="params">(e: <span class="type">Expr</span>)</span></span>: <span class="built_in">Int</span> =</span><br><span class="line">    <span class="keyword">when</span> (e) &#123;</span><br><span class="line">        <span class="keyword">is</span> Num -&gt; e.value</span><br><span class="line">        <span class="keyword">is</span> Sum -&gt; eval(e.left) + eval(e.right)</span><br><span class="line">        <span class="keyword">else</span> -&gt; <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Unknown expression&quot;</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Extension-Functions">
          <a href="#Extension-Functions" class="heading-link"><i class="fas fa-link"></i></a>Extension Functions</h2>
      <p>kotlin 支持为已经存在的类编写扩展方法，而且不需要对原有类进行任何改动，只需要使用<code>className.extensionFun</code>的形式就可以了</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">lastChar</span><span class="params">()</span></span> = <span class="keyword">this</span>.<span class="keyword">get</span>(<span class="keyword">this</span>.length - <span class="number">1</span>)</span><br></pre></td></tr></table></div></figure>

<p>任务要求为<code>Int</code>和<code>Pair&lt;Int, Int&gt;</code>分别实现一个扩展函数<code>r()</code>。<code>r()</code>函数的功能就是创建一个有理数。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">RationalNumber</span></span>(<span class="keyword">val</span> numerator: <span class="built_in">Int</span>, <span class="keyword">val</span> denominator: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="built_in">Int</span>.<span class="title">r</span><span class="params">()</span></span>: RationalNumber = RationalNumber(<span class="keyword">this</span>, <span class="number">1</span>)</span><br><span class="line"><span class="function"><span class="keyword">fun</span> Pair<span class="type">&lt;Int, Int&gt;</span>.<span class="title">r</span><span class="params">()</span></span>: RationalNumber = RationalNumber(<span class="keyword">this</span>.first, <span class="keyword">this</span>.second)</span><br></pre></td></tr></table></div></figure>


        <h2 id="Object-Expression">
          <a href="#Object-Expression" class="heading-link"><i class="fas fa-link"></i></a>Object Expression</h2>
      <p>任务的要求是创建一个比较器（comparator），提供给 Collection 类对 list 按照降序排序。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task10</span><span class="params">()</span></span>: List&lt;<span class="built_in">Int</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> arrayList = arrayListOf(<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>)</span><br><span class="line">    Collections.sort(arrayList, <span class="keyword">object</span> : Comparator&lt;<span class="built_in">Int</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">compare</span><span class="params">(o1: <span class="type">Int</span>, o2: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> o2 - o1</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> arrayList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="SAM-Conversions">
          <a href="#SAM-Conversions" class="heading-link"><i class="fas fa-link"></i></a>SAM Conversions</h2>
      <p>SAM conversions 就是如果一个 object 实现了一个 SAM（Single Abstract Method）接口时，可以直接传递一个 lambda 表达式。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task11</span><span class="params">()</span></span>: List&lt;<span class="built_in">Int</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> arrayList = arrayListOf(<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>)</span><br><span class="line">    arrayList.sortWith(Comparator &#123; x, y -&gt; y - x &#125;)</span><br><span class="line">    <span class="keyword">return</span> arrayList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Extensions-On-Collections">
          <a href="#Extensions-On-Collections" class="heading-link"><i class="fas fa-link"></i></a>Extensions On Collections</h2>
      <p>使用扩展函数<code>sortedDescending</code>重写上一个任务中的代码：</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task12</span><span class="params">()</span></span>: List&lt;<span class="built_in">Int</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> arrayListOf(<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>).sortedDescending()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="Collections">
          <a href="#Collections" class="heading-link"><i class="fas fa-link"></i></a>Collections</h1>
      <p>这一模块主要是集合的一些任务，所有任务都是围绕一个商店（Shop）展开，商店有一个客户（Customer）列表。</p>
<p>客户具有姓名、城市和订单（Order）列表三个属性。</p>
<p>订单具有商品（Product）列表和是否已经发货两个属性。</p>
<p>商品具有名称和价格两个属性。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Shop</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> customers: List&lt;Customer&gt;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> city: City, <span class="keyword">val</span> orders: List&lt;Order&gt;) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span> = <span class="string">&quot;<span class="variable">$name</span> from <span class="subst">$&#123;city.name&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span></span>(<span class="keyword">val</span> products: List&lt;Product&gt;, <span class="keyword">val</span> isDelivered: <span class="built_in">Boolean</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> price: <span class="built_in">Double</span>) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span> = <span class="string">&quot;&#x27;<span class="variable">$name</span>&#x27; for <span class="variable">$price</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">City</span></span>(<span class="keyword">val</span> name: String) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span> = name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Introduction-1">
          <a href="#Introduction-1" class="heading-link"><i class="fas fa-link"></i></a>Introduction</h2>
      <p>要求返回一个 <code>Set</code>，包含商店中所有的客户：</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">getSetOfCustomers</span><span class="params">()</span></span>: Set&lt;Customer&gt; &#123;</span><br><span class="line">    <span class="comment">// Return a set containing all the customers of this shop</span></span><br><span class="line">    <span class="keyword">return</span> customers.toSet()</span><br><span class="line"><span class="comment">//    return this.customers</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Filter-Map">
          <a href="#Filter-Map" class="heading-link"><i class="fas fa-link"></i></a>Filter Map</h2>
      <p><code>filter</code> 方法返回一个包含所有满足指定条件元素的列表。</p>
<p>任务第一个要求返回指定城市所有客户的列表。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">getCustomersFrom</span><span class="params">(city: <span class="type">City</span>)</span></span>: List&lt;Customer&gt; &#123;</span><br><span class="line">    <span class="comment">// Return a list of the customers who live in the given city</span></span><br><span class="line">    <span class="keyword">return</span> customers.filter &#123; it.city == city &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p><code>map</code> 方法将指定的转换函数运用到原始集合的每一个元素，并返回一个转换后的集合。</p>
<p>任务第二个要求返回所有客户所在城市的 Set。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">getCitiesCustomersAreFrom</span><span class="params">()</span></span>: Set&lt;City&gt; &#123;</span><br><span class="line">    <span class="comment">// Return the set of cities the customers are from</span></span><br><span class="line">    <span class="keyword">return</span> customers.map &#123; it.city &#125;.toSet()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="All-Any-and-others-Predicates">
          <a href="#All-Any-and-others-Predicates" class="heading-link"><i class="fas fa-link"></i></a>All Any and others Predicates</h2>
      <p><code>all</code>：如果所有的元素都满足指定的条件返回 true。</p>
<p><code>any</code>：如果至少有一个元素满足指定的条件返回 ture。</p>
<p><code>count</code>：返回满足指定条件的元素数量。</p>
<p><code>firstOrAll</code>：返回第一个满足指定条件的元素，如果没有就返回 null。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Customer.<span class="title">isFrom</span><span class="params">(city: <span class="type">City</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="comment">// Return true if the customer is from the given city</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.city == city</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">checkAllCustomersAreFrom</span><span class="params">(city: <span class="type">City</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="comment">// Return true if all customers are from the given city</span></span><br><span class="line">    <span class="keyword">return</span> customers.all &#123; it.isFrom(city) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">hasCustomerFrom</span><span class="params">(city: <span class="type">City</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="comment">// Return true if there is at least one customer from the given city</span></span><br><span class="line">    <span class="keyword">return</span> customers.any &#123; it.isFrom(city) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">countCustomersFrom</span><span class="params">(city: <span class="type">City</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="comment">// Return the number of customers from the given city</span></span><br><span class="line">    <span class="keyword">return</span> customers.count &#123; it.isFrom(city) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">findFirstCustomerFrom</span><span class="params">(city: <span class="type">City</span>)</span></span>: Customer? &#123;</span><br><span class="line">    <span class="comment">// Return the first customer who lives in the given city, or null if there is none</span></span><br><span class="line">    <span class="keyword">return</span> customers.firstOrNull &#123; it.isFrom(city) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="FlatMap">
          <a href="#FlatMap" class="heading-link"><i class="fas fa-link"></i></a>FlatMap</h2>
      <p><code>flatmap</code>：针对列表中的每一项根据指定的方法生成一个列表，最后将所有的列表拼接成一个列表返回。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回一个客户所有已订购的产品</span></span><br><span class="line"><span class="keyword">val</span> Customer.orderedProducts: Set&lt;Product&gt;</span><br><span class="line">    <span class="keyword">get</span>() &#123;</span><br><span class="line">        <span class="comment">// Return all products this customer has ordered</span></span><br><span class="line">        <span class="keyword">return</span> orders.flatMap &#123; it.products &#125;.toSet()</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 返回所有至少被一个客户订购过的商品集合</span></span><br><span class="line"><span class="keyword">val</span> Shop.allOrderedProducts: Set&lt;Product&gt;</span><br><span class="line">    <span class="keyword">get</span>() &#123;</span><br><span class="line">        <span class="comment">// Return all products that were ordered by at least one customer</span></span><br><span class="line">        <span class="keyword">return</span> customers.flatMap &#123; it.orderedProducts &#125;.toSet()</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Max-Min">
          <a href="#Max-Min" class="heading-link"><i class="fas fa-link"></i></a>Max Min</h2>
      <p><code>max</code>：返回集合中最大的元素。如果没有元素则返回 null。</p>
<p><code>maxby</code>：使用函数参数计算的值作为比较对象。返回最大的元素中的值。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回商店中订单数目最多的一个客户。</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">getCustomerWithMaximumNumberOfOrders</span><span class="params">()</span></span>: Customer? &#123;</span><br><span class="line">    <span class="comment">// Return a customer whose order count is the highest among all customers</span></span><br><span class="line">    <span class="keyword">return</span> customers.maxBy &#123; it.orders.size &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回一个客户所订购商品中价格最高的一个商品</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Customer.<span class="title">getMostExpensiveOrderedProduct</span><span class="params">()</span></span>: Product? &#123;</span><br><span class="line">    <span class="comment">// Return the most expensive product which has been ordered</span></span><br><span class="line">    <span class="keyword">return</span> orders.flatMap &#123; it.products &#125;.maxBy &#123; it.price &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Sort">
          <a href="#Sort" class="heading-link"><i class="fas fa-link"></i></a>Sort</h2>
      <p>kotlin 中可以通过 <code>sortby</code>指定排序的标准。</p>
<p>任务要求返回一个客户列表，客户的顺序是根据订单的数量由低到高。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">getCustomersSortedByNumberOfOrders</span><span class="params">()</span></span>: List&lt;Customer&gt; &#123;</span><br><span class="line">    <span class="comment">// Return a list of customers, sorted by the ascending number of orders they made</span></span><br><span class="line">    <span class="keyword">return</span> customers.sortedBy &#123; it.orders.size &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Sum">
          <a href="#Sum" class="heading-link"><i class="fas fa-link"></i></a>Sum</h2>
      <p><code>sumby</code>：将集合中所有元素按照指定的函数变换以后的结果累加。</p>
<p>任务要求计算一个客户所有已订购商品的价格总和。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Customer.<span class="title">getTotalOrderPrice</span><span class="params">()</span></span>: <span class="built_in">Double</span> &#123;</span><br><span class="line">    <span class="comment">// Return the sum of prices of all products that a customer has ordered.</span></span><br><span class="line">    <span class="comment">// Note: a customer may order the same product several times.</span></span><br><span class="line">    <span class="keyword">return</span> orders.flatMap &#123; it.products &#125;.sumByDouble &#123; it.price &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="GroupBy">
          <a href="#GroupBy" class="heading-link"><i class="fas fa-link"></i></a>GroupBy</h2>
      <p><code>groupBy</code>方法返回一个根据指定条件分组好的 map。</p>
<p>任务要求返回来自每一个城市的客户的 map：</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">groupCustomersByCity</span><span class="params">()</span></span>: Map&lt;City, List&lt;Customer&gt;&gt; &#123;</span><br><span class="line">    <span class="comment">// Return a map of the customers living in each city</span></span><br><span class="line">    <span class="keyword">return</span> customers.groupBy &#123; it.city &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Partition">
          <a href="#Partition" class="heading-link"><i class="fas fa-link"></i></a>Partition</h2>
      <p><code>partition</code>：将原始的集合分为一对集合，这一对集合中第一个是满足指定条件的元素集合，第二个是不满足指定条件的集合。</p>
<p>任务要求返回所有未发货订单数目多于已发货订单的用户。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">getCustomersWithMoreUndeliveredOrdersThanDelivered</span><span class="params">()</span></span>: Set&lt;Customer&gt; &#123;</span><br><span class="line">    <span class="comment">// Return customers who have more undelivered orders than delivered</span></span><br><span class="line">    <span class="keyword">return</span> customers.filter &#123;</span><br><span class="line">        <span class="keyword">val</span> (delivered, undelivered) = it.orders.partition &#123; it.isDelivered &#125;</span><br><span class="line">        delivered.size &lt; undelivered.size</span><br><span class="line">    &#125;.toSet()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Fold">
          <a href="#Fold" class="heading-link"><i class="fas fa-link"></i></a>Fold</h2>
      <p><code>fold</code>：给定一个初始值，然后通过迭代对集合中的每一个元素执行指定的操作并将操作的结果累加。</p>
<p>任务要求返回所有客户都订购过的商品。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">getSetOfProductsOrderedByEachCustomer</span><span class="params">()</span></span>: Set&lt;Product&gt; &#123;</span><br><span class="line">    <span class="comment">// Return the set of products that were ordered by each of the customers</span></span><br><span class="line">    <span class="keyword">return</span> customers.fold(allOrderedProducts, &#123; orderedByAll, customer -&gt;</span><br><span class="line">        orderedByAll.intersect(customer.orderedProducts)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></div></figure>


        <h2 id="CompoundTasks">
          <a href="#CompoundTasks" class="heading-link"><i class="fas fa-link"></i></a>CompoundTasks</h2>
      <p>上述方法的混合使用。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Customer.<span class="title">hasOrderedProduct</span><span class="params">(product: <span class="type">Product</span>)</span></span> = orders.any &#123; it.products.contains(product) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 所有购买了指定商品的客户列表</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">getCustomersWhoOrderedProduct</span><span class="params">(product: <span class="type">Product</span>)</span></span>: Set&lt;Customer&gt; &#123;</span><br><span class="line">    <span class="comment">// Return the set of customers who ordered the specified product</span></span><br><span class="line">    <span class="keyword">return</span> customers.filter &#123; it.hasOrderedProduct(product) &#125;.toSet()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找某个用户所有已发货的商品中最昂贵的商品</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Customer.<span class="title">getMostExpensiveDeliveredProduct</span><span class="params">()</span></span>: Product? &#123;</span><br><span class="line">    <span class="comment">// Return the most expensive product among all delivered products</span></span><br><span class="line">    <span class="comment">// (use the Order.isDelivered flag)</span></span><br><span class="line">    <span class="keyword">return</span> orders.filter &#123; it.isDelivered &#125;.flatMap &#123; it.products &#125;.maxBy &#123; it.price &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找指定商品被购买的次数</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Shop.<span class="title">getNumberOfTimesProductWasOrdered</span><span class="params">(product: <span class="type">Product</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="comment">// Return the number of times the given product was ordered.</span></span><br><span class="line">    <span class="comment">// Note: a customer may order the same product for several times.</span></span><br><span class="line">    <span class="keyword">return</span> customers.flatMap &#123; it.orders.flatMap &#123; it.products &#125; &#125;.count &#123; it == product &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="Extensions-On-Collections-1">
          <a href="#Extensions-On-Collections-1" class="heading-link"><i class="fas fa-link"></i></a>Extensions On Collections</h2>
      <p>重写 Java 代码</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Collection&lt;String&gt; <span class="title">doSomethingStrangeWithCollection</span><span class="params">(Collection&lt;String&gt; collection)</span> </span>&#123;</span><br><span class="line">    Map&lt;Integer, List&lt;String&gt;&gt; groupsByLength = Maps.newHashMap();</span><br><span class="line">    <span class="keyword">for</span> (String s : collection) &#123;</span><br><span class="line">        List&lt;String&gt; strings = groupsByLength.get(s.length());</span><br><span class="line">        <span class="keyword">if</span> (strings == <span class="keyword">null</span>) &#123;</span><br><span class="line">            strings = Lists.newArrayList();</span><br><span class="line">            groupsByLength.put(s.length(), strings);</span><br><span class="line">        &#125;</span><br><span class="line">        strings.add(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> maximumSizeOfGroup = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (List&lt;String&gt; group : groupsByLength.values()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (group.size() &gt; maximumSizeOfGroup) &#123;</span><br><span class="line">            maximumSizeOfGroup = group.size();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (List&lt;String&gt; group : groupsByLength.values()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (group.size() == maximumSizeOfGroup) &#123;</span><br><span class="line">            <span class="keyword">return</span> group;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>方法的目的是：</p>
<ul>
<li>将一个字符串集合按照长度分组，放入一个 map 中</li>
<li>求出 map 中所有元素 (String List) 的最大长度</li>
<li>根据步骤2的结果，返回 map 中字符串数目最多的那一组</li>
</ul>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doSomethingStrangeWithCollection</span><span class="params">(collection: <span class="type">Collection</span>&lt;<span class="type">String</span>&gt;)</span></span>: Collection&lt;String&gt;? &#123;</span><br><span class="line">    <span class="keyword">val</span> groupsByLength = collection.groupBy &#123; s -&gt; s.length &#125;</span><br><span class="line">    <span class="keyword">return</span> groupsByLength.values.maxBy &#123; group -&gt; group.size &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="Conventions">
          <a href="#Conventions" class="heading-link"><i class="fas fa-link"></i></a>Conventions</h1>
      
        <h2 id="Comparsion">
          <a href="#Comparsion" class="heading-link"><i class="fas fa-link"></i></a>Comparsion</h2>
      <p>实现日期对象大小的比较</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task25</span><span class="params">(date1: <span class="type">MyDate</span>, date2: <span class="type">MyDate</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> date1 &lt; date2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>其中类 <code>MyDate</code>需要实现 <code>Comparable</code>接口。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDate</span></span>(<span class="keyword">val</span> year: <span class="built_in">Int</span>, <span class="keyword">val</span> month: <span class="built_in">Int</span>, <span class="keyword">val</span> dayOfMonth: <span class="built_in">Int</span>) : Comparable&lt;MyDate&gt; &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">compareTo</span><span class="params">(other: <span class="type">MyDate</span>)</span></span> =</span><br><span class="line">            <span class="keyword">when</span> &#123;</span><br><span class="line">                other.year != year -&gt; year - other.year</span><br><span class="line">                other.month != month -&gt; month - other.month</span><br><span class="line">                <span class="keyword">else</span> -&gt; dayOfMonth - other.dayOfMonth</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="InRange">
          <a href="#InRange" class="heading-link"><i class="fas fa-link"></i></a>InRange</h2>
      <p>实现检查指定的日期是不是在某一个日期范围内。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">checkInRange</span><span class="params">(date: <span class="type">MyDate</span>, first: <span class="type">MyDate</span>, last: <span class="type">MyDate</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> date <span class="keyword">in</span> DateRange(first, last)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>DateRange 类已经定义好，需要添加 <code>contains</code>函数。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DateRange</span></span>(<span class="keyword">val</span> start: MyDate, <span class="keyword">val</span> endInclusive: MyDate) &#123;</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">contains</span><span class="params">(value: <span class="type">MyDate</span>)</span></span>: <span class="built_in">Boolean</span> = start &lt;= value &amp;&amp; value &lt;= endInclusive</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="RangeTo">
          <a href="#RangeTo" class="heading-link"><i class="fas fa-link"></i></a>RangeTo</h2>
      <p>这一个任务是要求实现<code>MyDate</code>类的<code>..</code>运算符。<code>..</code>运算符最终会翻译成<code>rangeTo()</code>函数，所以本任务就是实现<code>MyDate.rangeTo()</code>。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> MyDate.<span class="title">rangeTo</span><span class="params">(other: <span class="type">MyDate</span>)</span></span>: DateRange = DateRange(<span class="keyword">this</span>, other)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">checkInRange2</span><span class="params">(date: <span class="type">MyDate</span>, first: <span class="type">MyDate</span>, last: <span class="type">MyDate</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="comment">//todoTask27()</span></span><br><span class="line">    <span class="keyword">return</span> date <span class="keyword">in</span> first..last</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="ForLoop">
          <a href="#ForLoop" class="heading-link"><i class="fas fa-link"></i></a>ForLoop</h2>
      <p>任务要求对 DateRange 内的 MyDate 执行 for 循环，因此 DateRange 需要实现 Iterable 接口。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DateRange</span></span>(<span class="keyword">val</span> start: MyDate, <span class="keyword">val</span> endInclusive: MyDate) : Iterable&lt;MyDate&gt; &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">iterator</span><span class="params">()</span></span>: Iterator&lt;MyDate&gt; = DateIterator(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">contains</span><span class="params">(value: <span class="type">MyDate</span>)</span></span>: <span class="built_in">Boolean</span> = start &lt;= value &amp;&amp; value &lt;= endInclusive</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DateIterator</span></span>(<span class="keyword">val</span> dateRange: DateRange) : Iterator&lt;MyDate&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> current: MyDate = dateRange.start</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">hasNext</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> = current &lt;= dateRange.endInclusive</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">next</span><span class="params">()</span></span>: MyDate &#123;</span><br><span class="line">        <span class="keyword">val</span> result = current</span><br><span class="line">        current = current.nextDay()</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="OperatorOverloading">
          <a href="#OperatorOverloading" class="heading-link"><i class="fas fa-link"></i></a>OperatorOverloading</h2>
      <p>重载 <code>+</code>运算符：</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> MyDate.<span class="title">plus</span><span class="params">(timeInterval: <span class="type">TimeInterval</span>)</span></span> = addTimeIntervals(timeInterval, <span class="number">1</span>)</span><br></pre></td></tr></table></div></figure>

<p>重载<code>*</code>运算符：</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将TimeInterval的乘法结果定义成RepeatedTimeInterval</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RepeatedTimeInterval</span></span>(<span class="keyword">val</span> timeInterval: TimeInterval, <span class="keyword">val</span> number: <span class="built_in">Int</span>)</span><br><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> TimeInterval.<span class="title">times</span><span class="params">(number: <span class="type">Int</span>)</span></span> = RepeatedTimeInterval(<span class="keyword">this</span>, number)</span><br><span class="line"></span><br><span class="line"><span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> MyDate.<span class="title">plus</span><span class="params">(timeIntervals: <span class="type">RepeatedTimeInterval</span>)</span></span> = addTimeIntervals(timeIntervals.timeInterval, timeIntervals.number)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h2 id="Destructuring-Declaration">
          <a href="#Destructuring-Declaration" class="heading-link"><i class="fas fa-link"></i></a>Destructuring Declaration</h2>
      <p>kotlin 可以将一个对象的所有属性一次赋值给一堆变量</p>
<p>任务要求判断一个日期是否是闰年。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDate</span></span>(<span class="keyword">val</span> year: <span class="built_in">Int</span>, <span class="keyword">val</span> month: <span class="built_in">Int</span>, <span class="keyword">val</span> dayOfMonth: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isLeapDay</span><span class="params">(date: <span class="type">MyDate</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> (year, month, dayOfMonth) = date</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 29 February of a leap year</span></span><br><span class="line">    <span class="keyword">return</span> isLeapYear(year) &amp;&amp; month == <span class="number">1</span> &amp;&amp; dayOfMonth == <span class="number">29</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Years which are multiples of four (with the exception of years divisible by 100 but not by 400)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isLeapYear</span><span class="params">(year: <span class="type">Int</span>)</span></span>: <span class="built_in">Boolean</span> = year % <span class="number">4</span> == <span class="number">0</span> &amp;&amp; (year % <span class="number">100</span> != <span class="number">0</span> || year % <span class="number">400</span> == <span class="number">0</span>)</span><br></pre></td></tr></table></div></figure>


        <h2 id="Invoke">
          <a href="#Invoke" class="heading-link"><i class="fas fa-link"></i></a>Invoke</h2>
      <p>如果一个类实现了<code>invoke</code>函数，那么该类的实体对象在调用这个函数时可以省略函数名，<code>invoke</code>函数需要有<code>operator</code>修饰符。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task31</span><span class="params">(invokable: <span class="type">Invokable</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> invokable()()()().numberOfInvocations</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Invokable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> numberOfInvocations: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">invoke</span><span class="params">()</span></span>: Invokable &#123;</span><br><span class="line">        numberOfInvocations++</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="Properties">
          <a href="#Properties" class="heading-link"><i class="fas fa-link"></i></a>Properties</h1>
      
        <h2 id="Properties-1">
          <a href="#Properties-1" class="heading-link"><i class="fas fa-link"></i></a>Properties</h2>
      <p>kotlin 中可以为属性自定义 setter，格式如下：</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PropertyExample</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> counter = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> propertyWithCounter: <span class="built_in">Int</span>? = <span class="literal">null</span></span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            field = value</span><br><span class="line">            counter++</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>每次为 <code>propertyWithCounter</code> 赋值时，都会调用 <code>set</code>，kotlin 中不能直接声明字段，然而，当一个属性需要一个幕后字段时，Kotlin 会自动提供。这个幕后字段可以使用<code>field</code>标识符在访问器中引用。</p>

        <h2 id="LazyProperty">
          <a href="#LazyProperty" class="heading-link"><i class="fas fa-link"></i></a>LazyProperty</h2>
      <p><code>initializer</code>是一个<code>lambda </code>表达式，这个表达式会在<code>lazy</code>属性第一次被访问的时候执行，且仅执行一次</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LazyProperty</span></span>(<span class="keyword">val</span> initializer: () -&gt; <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> value: <span class="built_in">Int</span>? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">val</span> lazy: <span class="built_in">Int</span></span><br><span class="line">    <span class="keyword">get</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">            value = initializer()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value!!</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="DelegatesExamples">
          <a href="#DelegatesExamples" class="heading-link"><i class="fas fa-link"></i></a>DelegatesExamples</h2>
      <p>用委托实现懒加载</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LazyPropertyUsingDelegates</span></span>(<span class="keyword">val</span> initializer: () -&gt; <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> lazyValue: <span class="built_in">Int</span> <span class="keyword">by</span> lazy(initializer)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="HowDelegatesWork">
          <a href="#HowDelegatesWork" class="heading-link"><i class="fas fa-link"></i></a>HowDelegatesWork</h2>
      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EffectiveDate</span>&lt;<span class="type">R</span>&gt; : <span class="type">ReadWriteProperty</span>&lt;<span class="type">R, MyDate</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> timeInMillis: <span class="built_in">Long</span>? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">operator</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(thisRef: <span class="type">R</span>, property: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: MyDate = timeInMillis!!.toDate()</span><br><span class="line">    <span class="keyword">operator</span> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(thisRef: <span class="type">R</span>, property: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">MyDate</span>)</span></span> &#123; timeInMillis = value.toMillis() &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h1 id="Builders">
          <a href="#Builders" class="heading-link"><i class="fas fa-link"></i></a>Builders</h1>
      
        <h2 id="ExtensionFunctionLiterals">
          <a href="#ExtensionFunctionLiterals" class="heading-link"><i class="fas fa-link"></i></a>ExtensionFunctionLiterals</h2>
      <figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task36</span><span class="params">()</span></span>: List&lt;<span class="built_in">Boolean</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> isEven: <span class="built_in">Int</span>.() -&gt; <span class="built_in">Boolean</span> = &#123; <span class="keyword">this</span> % <span class="number">2</span> == <span class="number">0</span> &#125;</span><br><span class="line">    <span class="keyword">val</span> isOdd: <span class="built_in">Int</span>.() -&gt; <span class="built_in">Boolean</span> = &#123; <span class="keyword">this</span> % <span class="number">2</span> != <span class="number">0</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> listOf(<span class="number">42</span>.isOdd(), <span class="number">239</span>.isOdd(), <span class="number">294823098</span>.isEven())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="StringAndMapBuilders">
          <a href="#StringAndMapBuilders" class="heading-link"><i class="fas fa-link"></i></a>StringAndMapBuilders</h2>
      <p>类型扩展函数，仿照<code>buildString</code>实现<code>buildMap</code></p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;K, V&gt;</span> <span class="title">buildMap</span><span class="params">(build: <span class="type">MutableMap</span>&lt;<span class="type">K</span>, V&gt;.()</span></span> -&gt; <span class="built_in">Unit</span>): Map&lt;K, V&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> map = HashMap&lt;K, V&gt;()</span><br><span class="line">    map.build()</span><br><span class="line">    <span class="keyword">return</span> map</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">task37</span><span class="params">()</span></span>: Map&lt;<span class="built_in">Int</span>, String&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> buildMap &#123;</span><br><span class="line">        put(<span class="number">0</span>, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>..<span class="number">10</span>) &#123;</span><br><span class="line">            put(i, <span class="string">&quot;<span class="variable">$i</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="TheFunctionApply">
          <a href="#TheFunctionApply" class="heading-link"><i class="fas fa-link"></i></a>TheFunctionApply</h2>
      <p>使用<code>apply</code>重写上一练习中的功能</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">myApply</span><span class="params">(f: <span class="type">T</span>.() -&gt; <span class="type">Unit</span>)</span></span>: T &#123;</span><br><span class="line">    f()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="HtmlBuilders">
          <a href="#HtmlBuilders" class="heading-link"><i class="fas fa-link"></i></a>HtmlBuilders</h2>
      <p>把<code>products</code>填充进表格，并设置好背景色，运行<code>htmlDemo.kt</code>可以预览内容</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">renderProductTable</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">return</span> html &#123;</span><br><span class="line">        table &#123;</span><br><span class="line">            tr &#123;</span><br><span class="line">                td &#123;</span><br><span class="line">                    text(<span class="string">&quot;Product&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                td &#123;</span><br><span class="line">                    text(<span class="string">&quot;Price&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                td &#123;</span><br><span class="line">                    text(<span class="string">&quot;Popularity&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">val</span> products = getProducts()</span><br><span class="line">            <span class="keyword">for</span> ((index, product) <span class="keyword">in</span> products.withIndex()) &#123;</span><br><span class="line">                tr &#123;</span><br><span class="line">                    td (color = getCellColor(index, <span class="number">0</span>)) &#123;</span><br><span class="line">                        text(product.description)</span><br><span class="line">                    &#125;</span><br><span class="line">                    td (color = getCellColor(index, <span class="number">1</span>)) &#123;</span><br><span class="line">                        text(product.price)</span><br><span class="line">                    &#125;</span><br><span class="line">                    td (color = getCellColor(index, <span class="number">2</span>)) &#123;</span><br><span class="line">                        text(product.popularity)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.toString()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h2 id="BuildersHowItWorks">
          <a href="#BuildersHowItWorks" class="heading-link"><i class="fas fa-link"></i></a>BuildersHowItWorks</h2>
      <p>1：c，<code>td</code>是一个方法，这里的<code>td</code>显然是在调用<br>2：b，<code>color</code>是参数名，这里使用了命名参数<br>3：b，这里是个<code>lambda</code>表达式<br>4：c，<code>this</code>指向调用者</p>

        <h1 id="Generics">
          <a href="#Generics" class="heading-link"><i class="fas fa-link"></i></a>Generics</h1>
      
        <h2 id="GenericsFunctions">
          <a href="#GenericsFunctions" class="heading-link"><i class="fas fa-link"></i></a>GenericsFunctions</h2>
      <p>根据条件将一个集合分为两个集合。</p>
<figure class="highlight kotlin"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, C: MutableCollection&lt;T&gt;</span>&gt; Collection<span class="type">&lt;T&gt;</span>.<span class="title">partitionTo</span><span class="params">(first: <span class="type">C</span>, second: <span class="type">C</span>, predicate: (<span class="type">T</span>) -&gt; <span class="type">Boolean</span>)</span></span>: Pair&lt;C, C&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (element <span class="keyword">in</span> <span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (predicate(element)) &#123;</span><br><span class="line">            first.add(element)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            second.add(element)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Pair(first, second)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

</div></div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="http://wuzhangyang.com">贾小昆</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="http://wuzhangyang.com/2019/06/28/kotlin-koans-notes/">http://wuzhangyang.com/2019/06/28/kotlin-koans-notes/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://wuzhangyang.com/tags/Kotlin/">Kotlin</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://wuzhangyang.com/tags/Android/">Android</a></span></div><div class="post-share"><div class="social-share" data-sites="qzone, qq, weibo, wechat, douban, linkedin, facebook, twitter, google">Share to: </div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2019/07/28/yuv-format-explaination/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">YUV 格式详解</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2019/05/07/Android-PhotoViewEx/"><span class="paginator-prev__text">Android 图片预览库封装</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2020</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>贾小昆</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v5.1.1</span><span class="footer__devider">|</span><span>主题 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.1.1</span></div><div class="busuanzi"><span class="busuanzi-siteuv"><span class="busuanzi-siteuv__icon"><i class="fas fa-user"></i></span><span class="busuanzi-siteuv__info">访问人数</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_uv"></span></span><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">浏览总量</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="搜索文章（支持多关键词，请用空格分隔）"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.xml';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ 文章无标题 ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);</script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="/js/utils.js?v=2.1.1"></script><script src="/js/stun-boot.js?v=2.1.1"></script><script src="/js/scroll.js?v=2.1.1"></script><script src="/js/header.js?v=2.1.1"></script><script type="application/json" src="/search.xml"></script></body></html>